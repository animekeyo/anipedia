<html>

<head>

    <!---//////////////////////////------jquery------/////////////////////////--->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!---//////////////////////////------supabase------/////////////////////////--->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="/scripts/supabase.js"></script>
    <!---/////////////////////////------sweetalert------/////////////////////////--->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.7/dist/sweetalert2.all.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <!---/////////////////////////------hammer------/////////////////////////--->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.js"></script>
    <!---/////////////////////////------aos------/////////////////////////--->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <!---/////////////////////////------tippy------/////////////////////////--->
    <script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/scale.css" />
    <!---/////////////////////////------react------/////////////////////////--->
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!---/////////////////////////------firebase------/////////////////////////--->
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-functions.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-messaging.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-performance.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-remote-config.js"></script>
    <!---/////////////////////////------MAIN SCRIPTS------/////////////////////////--->
    <script src="/scripts/purl.js?clear-111"></script>
    <script src="/scripts/firebase.js?clear-111"></script>
    <script src="/scripts/tippy.js?clear-111"></script>
    <script src="/scripts/open_user.js?clear-111"></script>
    <script src="/scripts/get-view.js?clear-100"></script>
    <!----------------------------------------------------------------->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="manifest" href="manifest.webmanifest?clear-126">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <style>
        @import url("/styles/style.css?clear-6");
    </style>

</head>


<body>
    <a style="margin: 1rem;" href="/" class=" center-flex fixed logo-s ">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
            <circle cx="24" cy="24" r="24" fill="#12161B"></circle>
            <path d="M37 15L29.7778 21.8421L24 15L18.2222 21.8421L11 15V32.7895H37V15ZM13.8889 41H34.1111C34.8773 41 35.6121 40.7117 36.1539 40.1984C36.6956 39.6851 37 38.989 37 38.2632V35.5263H11V38.2632C11 38.989 11.3044 39.6851 11.8461 40.1984C12.3879 40.7117 13.1227 41 13.8889 41Z" fill="white"></path>
            <rect x="11" y="35" width="26" height="8" fill="#12161B"></rect>
            </svg>
    </a>
    <div style="background-image: url(/images/b3.jpg);" class="full-wh full-bg center-flex theme-LOGaDSS2">

        <div style="height: 400px;" class="center-flex relative theme-LOGaDSS21">
            <div class="full-wh absolute center-flex theme-LOGaDSS22">

                <form action="" class="center-flex LOGaDSS22x">
                    <label for="">Email</label>
                    <input in_email autocomplete="email" type="email" name="" id="" required>
                    <label for="">Password</label>
                    <input in_password type="password" autocomplete="new-password" name="" id="" required>
                    <button type="submit">Login</button>
                </form>
                <a href="/register" class="center-flex theme-SDFET34DF">
                    Register for new account!
                </a>
                <div data-v-6d5d5628="" data-v-c35114da="" class="agree-message agree-message">
                    By creating an account, you are agreeing to the
                    <a data-v-6d5d5628="" href="/terms-and-conditions" target="_blank" rel="noopener noreferrer">
                        Terms and conditions
                    </a> and the
                    <a data-v-6d5d5628="" href="/privacy" target="_blank" rel="noopener noreferrer">
                        Privacy policy
                    </a>
                </div>
            </div>
        </div>

    </div>
    <script>
        $(".LOGaDSS22x").on("submit", function(event) {
            event.preventDefault()
            console.log('workin')
            const email = $('[in_email]').val()
            const password = $('[in_password]').val()

            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userxs) => {
                    // Signed in
                    const user = firebase.auth().currentUser;

                    const ref = firebase.database().ref('/data/users/' + user.uid);

                    createTime = Date.now();
                    createTime = createTime.toString();
                    createTime = createTime.slice(0, -3);
                    createTime = parseInt(createTime);
                    ref.update({
                        onlineState: true,
                    });
                    ref.onDisconnect().update({
                        onlineState: false,
                        afkTimeout: createTime,
                    });
                    ref.once("value", snapshot => {
                        if (snapshot.val().username) {

                        } else {
                            firebase.database().ref('/data/users/' + user.uid).update({
                                username: 'keyo' + createTime,
                            });
                        }
                        if (snapshot.val().userid) {

                        } else {
                            firebase.database().ref('/data/users/' + user.uid).update({
                                userid: user.uid
                            });
                        }
                        if (snapshot.val().banner) {

                        } else {
                            firebase.database().ref('/data/users/' + user.uid).update({
                                banner: "/images/b1.jpg"
                            });
                        }
                        if (snapshot.val().profile_picture) {

                        } else {
                            if (profile_image) {
                                firebase.database().ref('/data/users/' + user.uid).update({
                                    profile_picture: profile_image
                                });
                            } else {
                                firebase.database().ref('/data/users/' + user.uid).update({
                                    profile_picture: "/images/icon.png"
                                });
                            }

                        }
                        if (snapshot.val().displayName) {

                        } else {
                            if (name) {
                                firebase.database().ref('/data/users/' + user.uid).update({
                                    displayName: name
                                });
                            } else {

                            }

                        }
                    });
                })
                .catch((error) => {
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    swal(errorMessage)
                });

        })
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                // User is signed in.
                $('.theme-LOGaDSS21').fadeOut()
                setTimeout(function() {
                    window.location.href = "/app";
                }, 0000)
                supabase.auth.signOut().then((response) => {
                    console.log('Log out from Supabase')
                })
            } else {
                // User is signed out.
            }
        });
        supabase.auth.onAuthStateChange((userx) => {
            if (userx) {

                const user = supabase.auth.user()
                if (user) {
                    console.log(user.user_metadata.avatar_url)
                    console.log(user.user_metadata.full_name)
                    console.log(user.email)
                    console.log(user)
                    $('[in_email]').val(user.email)
                    $('[in_name]').val(user.user_metadata.full_name)
                    if (user.user_metadata.avatar_url) {
                        const data = '<div PFPX class="full-bg avaterx-theme-sdDAD"> </div>';
                        $('.LOGaDSS22x').prepend(data)
                        $('.theme-LOGaDSS21').css('height', '600px')
                        $('[PFPX]').attr('image', user.user_metadata.avatar_url)
                        $('[PFPX]').css('background-image', 'url(' + user.user_metadata.avatar_url + ')')
                        $('.agree-message.agree-message.cc-DS34R').hide()
                        $('.center-flex.theme-LOGaDSS222').hide()
                    }
                }

            } else {
                // User is signed out
                // ...
            }
        });
        //let { user, error } = await supabase.auth.signIn({ provider: 'github' })

        $(document).on(
            'click',
            '[button-auth]',
            function() {
                const auth = $(this).attr('auth');
                supabase.auth.signIn({
                    provider: auth,
                })
            })
    </script>
</body>

</html>