<!DOCTYPE html>
<html lang="en">


<!---//////////////////////////------jquery------/////////////////////////--->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!---//////////////////////////------supabase------/////////////////////////--->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script src="/scripts/supabase.js"></script>
<!---/////////////////////////------sweetalert------/////////////////////////--->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.7/dist/sweetalert2.all.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<!---/////////////////////////------hammer------/////////////////////////--->
<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.js"></script>
<!---/////////////////////////------aos------/////////////////////////--->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<!---/////////////////////////------tippy------/////////////////////////--->
<script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js"></script>
<script src="https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js"></script>
<link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/scale.css" />
<!---/////////////////////////------react------/////////////////////////--->
<script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<!---/////////////////////////------firebase------/////////////////////////--->
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-functions.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-messaging.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-storage.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-performance.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-remote-config.js"></script>
<!---/////////////////////////------MAIN SCRIPTS------/////////////////////////--->
<script src="/scripts/purl.js?clear1-111"></script>
<script src="/scripts/firebase.js?clear1-111"></script>
<script src="/scripts/tippy.js?clear1-111"></script>
<script src="/scripts/open_user.js?clear1-111"></script>
<script src="/scripts/get-view.js?clear1-100"></script>
<!----------------------------------------------------------------->
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link rel="manifest" href="manifest.webmanifest?clear1-126">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
<style>
    @import url("/styles/style.css?clear1-80");
    .center-flex.full-wh.r5.theme-GfSHDHASH122 {
        background: transparent;
        margin: 2rem;
        display: flex;
        transition: 0.5s;
        flex-direction: row;
        justify-content: flex-start;
        align-items: flex-start;
        align-content: flex-start;
        overflow: hidden;
        padding: 0.5rem;
        gap: 0.5rem;
    }
    
    .center-flex.full-wh.r5.theme-GfSHDHASH1222,
    .center-flex.full-wh.r5.theme-GfSHDHASH1221 {
        background: var(--r1);
        border-radius: 10px;
    }
    
    .center-flex.full-wh.r5.theme-GfSHDHASH1221 {
        width: 250px;
        display: flex;
        transition: 0.1s;
        align-content: flex-start;
        justify-content: flex-start;
        align-items: flex-start;
        z-index: 2;
        padding: 1rem;
        height: auto;
    }
    
    .theme-GfSHDHASH12212 {
        display: flex;
        transition: 0.1s;
        align-content: flex-start;
        justify-content: flex-start;
        align-items: flex-start;
        gap: 0.5rem;
        margin: 1rem;
    }
    
    .center-flex.full-wh.r5.theme-GfSHDHASH12211 {
        height: 2.5rem;
        /* background: var(--c14); */
        display: flex;
        transition: 0.1s;
        flex-direction: row;
        justify-content: flex-start;
        padding: 0.2rem 0.6rem;
        gap: 0.4rem;
        font-size: 0.9rem;
        text-transform: uppercase;
        font-family: sans-serif;
        FONT-WEIGHT: 600;
    }
    
    .center-flex.full-wh.r5.theme-GfSHDHASH12211:hover {
        background-color: var(--c15);
        transition: 0.1s;
    }
    
    .center-flex.full-wh.r5.theme-GfSHDHASH12211 svg {
        fill: var(--c6);
        width: 1.7rem;
        height: 1.7rem;
        transition: 0.1s;
    }
    
    .center-flex.full-wh.r5.theme-GfSHDHASH1222 {
        margin: 0.5rem;
        margin-left: 265px;
        z-index: 1;
        transition: 0.1s;
        align-content: flex-start;
        justify-content: flex-start;
        align-items: flex-start;
        padding: 2rem;
    }
    
    .center-flex.full-wh.r5.theme-GfSHDHASH1222 div[setpage] {
        display: none;
    }
    
    .oh {
        overflow: hidden;
    }
    
    .center-flex.full-wh.theme-fx-Fdsd form {
        width: -webkit-fill-available;
        display: flex;
        transition: 0.1s;
        flex-direction: column;
        align-content: flex-start;
        justify-content: flex-start;
        align-items: flex-start;
        gap: 0.5rem;
        font-size: 1rem;
        color: var(--c6);
    }
    
    .center-flex.full-wh.theme-fx-Fdsd form input {
        width: -webkit-fill-available;
        height: 2.5rem;
        border-radius: 5px;
        padding: 0rem 0.8rem;
        background: var(--r5);
        color: var(--c6);
        font-family: sans-serif;
        transition: 0.1s;
        FONT-WEIGHT: 600;
        letter-spacing: 0.2px;
    }
    
    .center-flex.full-wh.theme-fx-Fdsd form button {
        height: 2.5rem;
        width: -webkit-fill-available;
        transition: 0.1s;
        margin-top: 1rem;
        border: unset;
        border-radius: 5px;
        color: var(--c6);
        background: var(--c7);
        font-family: sans-serif;
        FONT-WEIGHT: 600;
        letter-spacing: 0.3px;
    }
    
    .center-flex.full-wh.theme-fx-Fdsd form input[type="file"] {
        /* background: unset; */
        padding: 0.6092rem;
        margin: unset;
        height: unset;
        transition: 0.1s;
    }
    
    .center-flex.full-wh.theme-fx-Fdsd form .theme-dfXD .icon {
        height: 48px;
        width: 48px;
        background-color: var(--c7);
        border-radius: 100rem;
        margin-bottom: 1rem;
        transition: 0.1s;
    }
    
    .center-flex.full-wh.theme-fx-Fdsd form .theme-dfXD .banner {
        background-color: var(--c7);
        width: 240px;
        height: 135.99px;
        border-radius: 5px 0px 0px 5px;
        transition: 0.1s;
    }
    
    .center-flex.theme-dfXD {
        display: flex;
        align-content: flex-start;
        align-items: flex-start;
        flex-direction: row;
        justify-content: flex-end;
        width: -webkit-fill-available;
        gap: 1rem;
        margin: 1rem 0rem;
        background: var(--r4);
        padding: 1rem 0rem;
        width: 20rem;
        border-radius: 10px;
        transition: 0.1s;
    }
    
    .center-flex.full-wh.theme-fx-Fdsd {
        /* width: fit-content; */
        height: fit-content;
        margin: 1rem;
        transition: 0.1s;
    }
    
    .center-flex.full-wh.theme-fx-Fdsd form h3 {
        margin: 0.5rem;
        font-size: 1.3rem;
        width: -webkit-fill-available;
        transition: 0.1s;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: unset;
    }
    
    .center-flex.full-wh.r5.relative.theme-GfSHDHASH122.Join-Server {
        height: 29rem;
    }
    
    .center-flex.full-wh.r5.relative.theme-GfSHDHASH122.Create-Server {
        height: 42rem;
    }
    
    .center-flex.full-wh.theme-fx-Fdsd form h4 {
        margin: 1rem 0rem;
        margin-top: 0.5rem;
        color: #a7a7a7;
    }
    
    .agree-message.agree-message.prs {
        color: gray;
        font-family: sans-serif;
        letter-spacing: 0.1px;
        font-size: 1rem;
    }
</style>

<body>
    <div class="center-flex full-bg full-wh fixed theme-GfSHDHASH12">
        <div style="width: 42rem;" class="center-flex full-wh r5 relative theme-GfSHDHASH122">
            <div style="width: 210px;" class="center-flex full-wh r5 theme-GfSHDHASH1221">
                <div class="center-flex full-wh r5 theme-GfSHDHASH12212">

                </div>
            </div>
            <div class="center-flex full-wh r5 absolute theme-GfSHDHASH1222">

                <div setpage setpagex="Create-Server" class="oh full-wh">

                    <div class="center-flex full-wh  theme-fx-Fdsd">
                        <form action="">
                            <h3>
                                Customize Your Server
                            </h3>
                            <div class="center-flex theme-dfXD">
                                <div upload-server-icon class="icon full-bg">

                                </div>
                                <div upload-server-banner class="banner full-bg">

                                </div>
                            </div>

                            <label for="">Server Icon</label>
                            <input required create-server-icon type="file" icon="upload-server-icon" accept="image/*" name="" id="">
                            <label for="">Server Name</label>
                            <input create-server-name-input type="text" required autocomplete="name">

                            <label for="">Server Banner</label>
                            <input required create-server-banner type="file" icon="upload-server-banner" accept="image/*" name="" id="">
                            <button create-server-btn>Create</button>

                            <div data-v-6d5d5628="" data-v-c35114da="" class="agree-message agree-message">
                                By creating a server, you are agreeing to the
                                <a data-v-6d5d5628="" href="/terms-and-conditions" target="_blank" rel="noopener noreferrer">
                                    Terms and conditions
                                </a> and the
                                <a data-v-6d5d5628="" href="/privacy" target="_blank" rel="noopener noreferrer">
                                    Privacy policy
                                </a>
                            </div>
                        </form>

                    </div>


                </div>
                <div setpage setpagex="Join-Server" class="oh full-wh">

                    <div class="center-flex full-wh  theme-fx-Fdsd">
                        <form action="">
                            <h3>
                                Join a Server
                            </h3>
                            <h4>
                                Enter an invite below to join an existing server
                            </h4>
                            <label for="">Invite Link</label>
                            <input join-server-invite-link-input type="text" required autocomplete="name">
                            <h4>
                                Invites should look like
                            </h4>
                            <div class="agree-message agree-message prs">
                                animekeyo.com/invite/1020432035034530
                                <br>/1020432035034530
                                <br>in/1020432035034530
                                <br>keyoani.me/neko
                            </div>
                            <button>Create</button>


                        </form>

                    </div>


                </div>

            </div>
        </div>
    </div>
    <script src="/scripts/com.js?clear1-7"></script>
    <script>
        var images = ['1', '2', '3', '5', '8', '9', '10'];

        $('.theme-GfSHDHASH12').css('background-image', 'url(/images/bg' + images[Math.floor(Math.random() * images.length)] + '.jpg)');
        const data_ixo = [{
            "icon": icon_add,
            "title": "Create Server",
            "get": 'Create-Server',
        }, {
            "icon": icon_add_link,
            "title": "Join Server",
            "get": 'Join-Server',
        }];


        $(document).on("change", 'input[type="file"]', function() {

            var $files = $(this).get(0).files;
            const appendtoc = $(this).attr('icon');
            if ($files.length) {

                // Reject big files
                if ($files[0].size > $(this).data("max-size") * 1024) {
                    console.log("Please select a smaller file");
                    return false;
                }

                // Replace ctrlq with your own API key
                var apiUrl = 'https://api.imgur.com/3/image';
                var apiKey = '4b208caca83b4c4';

                var formData = new FormData();
                formData.append("image", $files[0]);

                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": apiUrl,
                    "method": "POST",
                    "datatype": "json",
                    "headers": {
                        "Authorization": "Client-ID " + apiKey
                    },
                    "processData": false,
                    "contentType": false,
                    "data": formData,
                    beforeSend: function(xhr) {
                        swal({
                            text: "Uploading",
                            buttons: false,
                            closeOnClickOutside: false,
                        });
                    },
                    success: function(res) {
                        console.log(res.data.link);
                        console.log(appendtoc)
                        var user = firebase.auth().currentUser;
                        var pfp = res.data.link;
                        $('[' + appendtoc + ']').css('background-image', 'url(' + pfp + ')');
                        ///

                    },
                    error: function() {

                        swal("Failed | 上传失败 | MAKO");
                    }
                }
                $.ajax(settings).done(function(response) {
                    console.log("Done | 成功");
                    swal({
                        title: "Done",
                        icon: "success",
                        timer: 1500,
                    });
                });
            }
        });


        $('form').on("submit", function(event) {
            event.preventDefault()
            console.log(event)
            const server_name = $('[create-server-name-input]').val();
            const server_banner = $('[upload-server-banner]').css('background-image').replace(/^url\(['"](.+)['"]\)/, '$1');
            const server_icon = $('[upload-server-icon]').css('background-image').replace(/^url\(['"](.+)['"]\)/, '$1');

            if (server_name) {
                firebase.auth().onAuthStateChanged(function(user) {
                    if (user) {
                        const currentUserID = firebase.auth().currentUser.uid;
                        swal('' + server_banner + server_name + server_icon + '')
                        const TD = new Date();
                        const TD2 = TD.getTime();
                        const TD23 = TD.getFullYear();
                        const TD234 = TD.getMonth();
                        const TD2345 = TD.getMilliseconds();
                        const TD23456 = TD.getDay();
                        const create_link = TD2 + "" + TD23 + "" + TD234 + "" + TD2345 + "" + TD23456;
                        const Milliseconds = TD.getMilliseconds();
                        const serverID = create_link + Milliseconds;
                        const database = firebase.database().ref('/data/users/' + currentUserID + '/server/' + serverID);
                        const database2 = firebase.database().ref('/data/users/' + currentUserID + '/join/' + serverID);
                        const database3 = firebase.database().ref('/data/servers/' + serverID);
                        database3.update({
                            serverId: serverID,
                            userid: currentUserID,
                        }).then(
                            function name(params) {
                                console.log('Done-1')
                            }
                        );
                        database.update({
                            serverId: serverID,
                            userid: currentUserID,
                            serverId: serverID,
                            serverName: server_name,
                            serverIcon: server_icon,
                            serverBanner: server_banner,
                        }).then(
                            function name(params) {
                                console.log('Done-2')
                            }
                        );
                        database.child('members').child(currentUserID).update({
                            userid: currentUserID,
                            member: true,
                            mute: false,
                        }).then(
                            function name(params) {
                                console.log('Done-3')
                            }
                        );

                        database2.update({
                            serverId: serverID,
                            userid: currentUserID,
                        }).then(
                            function name(params) {
                                console.log('Done-4')
                                swal('Done', 'Server has been created!')
                                setTimeout(
                                    function name(params) {
                                        window.location.href = "/app";
                                    }, 1000
                                )
                            }
                        );
                    }
                });

            }
            const server_link = $('[join-server-invite-link-input]').val();
            if (server_link) {
                var numberRegex = /^[+-]?\d+(\.\d+)?([eE][+-]?\d+)?$/;
                firebase.auth().onAuthStateChanged(function(user) {
                    if (user) {
                        const currentUserID = firebase.auth().currentUser.uid;
                        const database3 = firebase.database().ref('/data/servers/' + server_link);

                        const database = firebase.database().ref('/data/users/' + currentUserID + '/join/' + server_link);
                        if (numberRegex.test(server_link)) {
                            // this is for only simple join link like just numbers 

                            database3.once('value', function(snapshot) {
                                const serverId = (snapshot.val() && snapshot.val().serverId);
                                const userid = (snapshot.val() && snapshot.val().userid);
                                if (snapshot.exists()) {
                                    database.once('value', function(snapshot) {
                                        if (snapshot.exists()) {
                                            swal('Error', 'You already joined/owned this server')
                                        } else {
                                            const database = firebase.database().ref('/data/users/' + userid + '/server/' + serverId);
                                            const database2 = firebase.database().ref('/data/users/' + currentUserID + '/join/' + serverId);

                                            if (serverId) {
                                                if (userid) {
                                                    database2.once('value', function(snapshot) {
                                                        if (snapshot.exists()) {

                                                        } else {
                                                            database.child('members').once('value', function(snapshot) {
                                                                if (snapshot.exists()) {

                                                                } else {
                                                                    database.child('members').child(currentUserID).update({
                                                                        userid: currentUserID,
                                                                        member: true,
                                                                        mute: false,
                                                                    }).then(function() {
                                                                        console.log('Done')
                                                                    }, function() {
                                                                        console.log('Error')
                                                                    });

                                                                }
                                                            })
                                                            database2.update({
                                                                serverId: serverId,
                                                                userid: userid,
                                                            }).then(function() {
                                                                console.log('Done')
                                                                swal('Joined')
                                                            }, function() {
                                                                console.log('Error')
                                                            });
                                                        }
                                                    })
                                                }
                                            }


                                        }

                                    })

                                } else {
                                    swal(
                                        'Error',
                                        'Server Dont Exist or The Link is Broken'
                                    )
                                }
                            })
                        } else {
                            swal(
                                    'Error ',
                                    'Sorry only simple/number link are allowed atm'
                                )
                                // this is for other stuff non as link with letter abc and nummbers
                        }
                    }
                })
            }
        })
        $.each(data_ixo, function(o, v) {
            //////////BUTTONS/////////
            const data =
                '<div setbtn get="' + v.get + '" count="' + o++ + '"  class=" pointer noselect center-flex full-wh r5 theme-GfSHDHASH12211">' +
                v.icon +
                ///icon
                '<div class="center-flex r5 theme-GfSHDHASH12211c">' +
                v.title +
                ///title
                '</div>' +
                '</div>';

            //////CONTENT//////////
            //const data1 =
            // '<div setpage setpagex="' + v.get + '">' +
            // v.title +
            // '</div>';
            //$('.theme-GfSHDHASH1222').append(data1);

            ///////append to////////
            $('.theme-GfSHDHASH12212').append(data);

        });
        $('[setbtn][count="0"]').ready(function() {
            $('[setbtn][count="0"]').trigger("click");
        });
        $('[type="file"]').change(function() {
            readURL(this);
            const icon = $(this).attr('icon')

            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function(e) {
                        //$('[' + icon + ']').css('background-image', 'url(' + e.target.result + ')');
                    }

                    reader.readAsDataURL(input.files[0]);
                }
            }
        });
        $(document).on(
            'click',
            '[setbtn]',
            function() {
                const get = $(this).attr('get');
                if (get) {
                    $('input').val('')
                    $('[setbtn]').css('background', 'var(--r2)')
                    $(this).css('background', 'var(--r5)')
                    $('[setpage]').hide()
                    $('[setpagex="' + get + '"]').show()
                    const pick = $('.theme-GfSHDHASH122').attr('pick');
                    $('.theme-GfSHDHASH122').removeClass(pick);
                    $('.theme-GfSHDHASH122').removeAttr('pick')
                    $('.theme-GfSHDHASH122').attr('pick', get)
                    const pickadd = $('.theme-GfSHDHASH122').attr('pick');
                    $('.theme-GfSHDHASH122').addClass(pickadd)

                }

            }
        )
    </script>
</body>

</html>